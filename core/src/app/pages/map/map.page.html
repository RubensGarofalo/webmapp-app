<ion-content scrollY="false">
  <div class="webmapp-pageroute-map-container">
    <wm-map
      #wmap
      [conf]="confMap$|async"
      [map]="(wmap.map$|async)"
      [reset]="resetEvt$|async"
      [padding]="padding$|async"
      wmMapLayer
      [layer]="currentLayer$|async"
      [dataLayerUrls]="dataLayerUrls$|async"
      [disableLayers]="(currentFilters$|async).length > 0"
      (trackSelectedFromLayerEVT)="goToTrack($event)"
      wmMapPois
      [poi]="currentPoiID$|async"
      [pois]="pois$|async"
      [filters]="currentFilters$|async"
      [WmMapPoisUnselectPoi]="this.resetSelectedPoi$|async"
      [onClick]="wmap.clickEVT$"
      (poi-click)="openPoi($event)"
      (currentPoiEvt)="setPoi($event)"
      wmMapPosition
      [position]="setCurrentPosition$|async"
      (locationEvt)="setCurrentLocation($event)"
      [wmMapOverlay]="enableOverLay$|async"
      [wmMapOverlayUrl]="'https://geohub.webmapp.it/api/taxonomy/where/geojson/13'"
    ></wm-map>
  </div>
  <div class="wm-fab-buttons">
    <wm-btn-center-position
      *ngIf="false"
      (click)="setCurrentPosition$.next($event)"
    ></wm-btn-center-position>
  </div>
  <ng-container *ngIf="confPOIS$|async as confPois">
    <wm-btn-filter
      *ngIf="confPois.apppoisApiLayer"
      [filters]="confPOISFilter$|async"
      [initSelectedFilters]="currentFilters$|async"
      (selectedFilters)="setCurrentFilters($event)"
    ></wm-btn-filter>
  </ng-container>

  <ng-container *ngIf="currentPoi$|async as currentPoi">
    <ng-container *ngIf="currentPoi.properties as properties">
      <ion-fab-button (click)="resetPoi()" size="small" class="webmapp-poi-close">
        <i class="icon-outline-close"></i>
      </ion-fab-button>
      <div class="webmapp-pagepoi-info-container">
        <div class="webmapp-pagepoi-info-header">
          <div
            class="webmapp-pagepoi-info-header-pre-title"
            *ngIf="properties.taxonomy.poi_type as poiType"
          >
            {{ poiType.name | wmtrans}}
          </div>
          <div class="webmapp-pagepoi-info-header-title" *ngIf="properties.name as name">
            {{ name | wmtrans}}
          </div>

          <div class="webmapp-pagepoi-info-header-arrows">
            <div class="ripple-parent ion-activatable webmapp-pagepoi-info-header-arrow">
              <ion-ripple-effect></ion-ripple-effect>
            </div>
          </div>
        </div>

        <ion-content class="webmapp-pagepoi-info-body" scrollY="true">
          <wm-image-gallery [imageGallery]="properties.image_gallery"></wm-image-gallery>
          <div
            *ngIf="properties.address as address"
            class="ripple-parent ion-activatable webmapp-pagepoi-info-reference"
          >
            <i class="icon-outline-pin webmapp-pagepoi-info-icon"></i>
            <a
              href="https://www.google.com/maps?daddr={{properties.address_link}}&navigate=yes"
              target="_blank"
            >
              {{address}}
            </a>
            <ion-ripple-effect></ion-ripple-effect>
          </div>
          <div
            *ngIf="properties.contact_phone as phone"
            class="ripple-parent ion-activatable webmapp-pagepoi-info-reference"
            (click)="phone(phone)"
          >
            <a href="tel:{{phone}}">
              <i class="icon-outline-phone webmapp-pagepoi-info-icon"></i>
              {{phone}}</a
            >
            <ion-ripple-effect></ion-ripple-effect>
          </div>
          <div
            *ngIf="properties.contact_email as email"
            class="ripple-parent ion-activatable webmapp-pagepoi-info-reference"
            (click)="email(email)"
          >
            <a href="mailto:{{email}}">
              <i class="icon-outline-mail webmapp-pagepoi-info-icon"></i>
              {{email}}
              <ion-ripple-effect></ion-ripple-effect>
            </a>
          </div>
          <div
            *ngIf="properties.related_url as relatedUrl"
            class="ripple-parent ion-activatable webmapp-pagepoi-info-reference"
            (click)="url(relatedUrl)"
          >
            <webmapp-related-urls [relatedUrls]="relatedUrl"> </webmapp-related-urls>
            <ion-ripple-effect></ion-ripple-effect>
          </div>

          <div
            class="webmapp-pagepoi-info-body-description"
            [innerHTML]="properties.description | wmtrans"
          ></div>
          <ng-container *ngIf="properties.audio">
            <webmapp-track-audio [audio]="properties.audio"></webmapp-track-audio>
          </ng-container>
        </ion-content>
      </div>
    </ng-container>
  </ng-container>
</ion-content>
