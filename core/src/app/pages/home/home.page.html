<ion-content class="webmapp-home-content">
  <ng-container *ngIf="(online$|async)=== false">
    <div class="wm-home-header-container">
      <downloaded-tracks-box></downloaded-tracks-box>
    </div>
  </ng-container>
  <ng-container *ngIf="(online$|async) === true">
    <div class="wm-home-header-container">
      <webmapp-home-intro class="wm-home-header-intro"> </webmapp-home-intro>
      <ion-label
        [innerHTML]="sanitizer.bypassSecurityTrustHtml((confAPP$|async).welcome | wmtrans)"
      >
      </ion-label>
      <webmapp-search-bar
        #searchCmp
        [initSearch]="title"
        (isTypings)="isTyping$.next($event);checkTab($event)"
        (words)="currentSearch$.next($event)"
        [currentLayer]="currentLayer$|async"
      >
      </webmapp-search-bar>
      <wm-btn-filter
        #filterCmp
        *ngIf="poiCards$|async"
        [filters]="confPOISFilter$|async"
        [initSelectedFilters]="selectedFilters$|async"
        (selectedFilters)="setCurrentFilters($event)"
      ></wm-btn-filter>
    </div>
    <ng-container *ngIf="currentTab$|async as currentTab">
      <ion-breadcrumbs>
        <ion-breadcrumb (click)="goToHome()" *ngIf="currentTab != 'home'"
          >{{'Home'|wmtrans}}</ion-breadcrumb
        >
        <ion-breadcrumb
          *ngIf="currentLayer$|async as currentLayer"
          (click)="currentTab$.next('tracks');searchCmp.reset()"
        >
          {{currentLayer.title|wmtrans}}</ion-breadcrumb
        >
        <ng-container *ngIf="(poiCards$|async) as poiCards">
          <ion-breadcrumb
            *ngIf="(selectedFilters$|async) as filters"
            (click)="currentTab$.next('pois');searchCmp.reset()"
          >
            <ng-container *ngIf="(selectedFilters$|async) as filters;">
              <ng-container *ngIf="filters.length ===1">
                {{(currentSelectedFilter$|async)?.name|wmtrans}}
              </ng-container>
              <ng-container *ngIf="filters.length >1">POIS</ng-container>
            </ng-container>
          </ion-breadcrumb>
        </ng-container>
        <ion-breadcrumb *ngIf="currentTab.indexOf('search')>0">
          {{'search'|wmtrans}}</ion-breadcrumb
        >
      </ion-breadcrumbs>
      <ng-container *ngIf="currentLayer$|async as layer">
        <div class="layer-details" *ngIf="layer.subtitle!=null || layer.description!= null">
          <a *ngIf="layer.subtitle as subtitle">{{subtitle|wmtrans}}</a>
          <p *ngIf="layer.description as description">{{description|wmtrans}}</p>
        </div>
      </ng-container>
      <wm-home
        *ngIf="currentTab === 'home'"
        [conf]="confHOME$|async"
        (openSlugEvt)="openSlug($event)"
        (selectedLayerEvt)="setLayer($event)"
        (selectedTrackEvt)="searchCard($event)"
        (filterClickEvt)="toggleFilter($event)"
      ></wm-home>
      <wm-search-list
        *ngIf="currentTab === 'tracks'"
        [cards]="elasticSearch$|async"
        [currentTab]="'tracks'"
        (selectedTrackEvt)="searchCard($event)"
      ></wm-search-list>
      <wm-search-list
        *ngIf="currentTab === 'pois'"
        [pois]="poiCards$|async"
        [currentTab]="'pois'"
        (selectedPoiEvt)="setPoi(+$event)"
      ></wm-search-list>
      <ng-container *ngIf="currentTab === 'pois-search'">
        <wm-search-list
          [pois]="poiCards$|async"
          [currentTab]="'pois'"
          (selectedPoiEvt)="setPoi(+$event)"
        ></wm-search-list>
      </ng-container>
      <ng-container *ngIf="currentTab === 'tracks-search'">
        <wm-search-list
          [cards]="elasticSearch$|async"
          [currentTab]="'tracks'"
          (selectedTrackEvt)="searchCard($event)"
        ></wm-search-list>
      </ng-container>
      <ng-container *ngIf="currentTab === 'home-search'">
        <wm-search-list
          [pois]="poiCards$|async"
          [cards]="elasticSearch$|async"
          [currentTab]="'tracks'"
          (selectedTrackEvt)="searchCard($event)"
          (selectedPoiEvt)="setPoi(+$event)"
        ></wm-search-list>
      </ng-container>
    </ng-container>
  </ng-container>
</ion-content>
